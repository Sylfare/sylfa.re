---
import TrucsSympas from '@layouts/TrucsSympas.astro';
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';

export const getStaticPaths = (async (paginate) => {
    const trucsSympas = await getCollection('trucSympa');
    const trucsTries = trucsSympas.sort((a, b) => new Intl.Collator('fr').compare(a.data.nom, b.data.nom));

    return paginate.paginate(trucsTries, {pageSize: 10});
}) satisfies GetStaticPaths;

const trucsSympas = await getCollection('trucSympa');
const tags: {
    [index: string]: number
} = {}

trucsSympas.forEach(truc => truc.data.tags?.forEach(tag => 
    Object.hasOwn(tags, tag) ? tags[tag]++ : (tags[tag] = 1)
));

const { page } = Astro.props;

---
<TrucsSympas {page} trucs={page.data} tagCount={tags}>

</TrucsSympas>
